!function(e,n){e.fn.openapp=function(t){function o(e,n,t,o){var p="__jsonp"+parseInt(1e4*Math.random(),10),i="string"==typeof e?e:e.url,a=e.field||"callback",l=e.timeout||!1,d=null,c=document.createElement("script"),r=null,s=null,u={done:[],fail:[],always:[]},f={done:function(e){return u.done.push(e),h(),f},fail:function(e){return u.fail.push(e),h(),f},always:function(e){return u.always.push(e),h(),f}},x=function(e,n){for(;cb=e.shift();)cb.apply(this,n)},h=function(){r&&(x(u[r],s),x(u.always,s))},w=function(e,n){r||(r=["fail","done"][+e],s=n,h())
},g=function(){return i+["?","&"][+(i.indexOf("?")>=0)]+[encodeURIComponent(a),encodeURIComponent(p)].join("=")},b=function(){c.src=g(),c.async=!0,c.addEventListener("error",A,!0),e.done&&f.done(e.done),e.fail&&f.fail(e.fail),e.always&&f.always(e.always),n&&f.done(n),t&&f.fail(t),o&&f.always(o)},m=function(){window[p]=y,document.body.appendChild(c),l&&(d=setTimeout(A,l))},k=function(){r||(delete window[p],document.body.removeChild(c),d&&(clearTimeout(d),d=null))},y=function(){r||(k(),w(!0,arguments))
},A=function(){r||(k(),w(!1,arguments))};return b(),m(),f}function p(n,t){var o={mask:e('<div id="J_OpenAppMask"/>').css({width:"100%",height:Math.max(e(window).height(),e("html").height()),background:"rgba(0,0,0,.5)",display:"block",position:"absolute",visibility:"visible",zIndex:1e3,top:0,left:0}),popup:{container:e('<div id="J_OpenAppPopup"/>').css({position:"absolute",display:"block",visibility:"visible",top:"50%",left:"50%",marginLeft:-145,marginTop:-100+window.scrollY,border:"1px solid #eee",width:290,zIndex:1009,fontSize:15,borderRadius:2,background:"#fff"}),downloaded:'<p style="font-size: 16px; font-weight: bold; padding:18px 0;text-align:center;color:#2A8DE8">'+n.downloadedPopupHeaderText+'</p><p style="padding:0 20px; font-size: 16px;font-family: bold;text-align:left;">'+n.downloadedPopupBodyText+'</p><div style="margin-top: 32px; border-top: 1px solid rgb(211, 211, 211); line-height: 40px;"><a id="J_OpenAppCancel" href="#" style="display: inline-block; height: 40px; width: 142px; text-decoration: initial; color: rgb(136, 136, 136); text-align: center;font-size:15px;">'+n.buttonText[0]+'</a><a id="J_OpenAppOk" href="{download}" style="display: inline-block; height: 40px; width: 143px; text-align: center; border-left: 1px solid rgb(211, 211, 211); text-decoration: initial; color: #2A8DE8;font-size:15px;">'+n.buttonText[1]+"</a></div>",undownload:'<p style="font-size: 16px; font-weight: bold; padding:18px 0;text-align:center;color:#2A8DE8">'+n.popupHeaderText+'</p><p style="padding:0 20px; color: #555;text-align:left;">'+n.undownloadPopupBodyText+'</p><div style="margin-top: 32px; border-top: 1px solid rgb(211, 211, 211); line-height: 40px;"><a id="J_OpenAppCancel" href="#" style="display: inline-block; height: 40px; width: 142px; text-decoration: initial; color: rgb(136, 136, 136); text-align: center; font-size:15px;">'+n.buttonText[0]+'</a><a id="J_OpenAppOk" href="{download}" style="display: inline-block; height: 40px; width: 143px; text-align: center; border-left: 1px solid rgb(211, 211, 211); text-decoration: initial; color: #2A8DE8;font-size:15px;">'+n.buttonText[1]+"</a></div>",render:function(e){var n=localStorage&&localStorage[r.packageName]&&"1"===localStorage[r.packageName]?this.downloaded:this.undownload,t=n.replace(/\{version\}/,e.result.version).replace(/\{size\}/,e.result.size).replace(/\{download\}/,e.result.download);
return this.container.html(t),this.container}}};e("#J_OpenAppMask").length?e("#J_OpenAppMask").show():e("body").append(o.mask),e("body").append(o.popup.render(t))}function i(){e("#J_OpenAppMask").hide(),e("#J_OpenAppPopup").remove()}function a(n){return r.appInfo?(appInfo={result:r.appInfo},n.call(null,appInfo)):void(c?n.call(null,c):e.ajaxJSONP({url:r.lastestAppUri+"&getapp="+r.packageName,success:function(e){c=e,n.call(null,c)},complete:function(){}}))}function l(e,t){n.openapp[r.packageName]=1,o({url:s,timeout:2e3,done:function(o){0===o.error?(n.openapp[r.packageName]=2,e()):(n.openapp[r.packageName]=0,t())
},fail:function(){n.openapp[r.packageName]=0,t()},always:function(){}})}function d(){var n,t=e('<div id="J_OpenAppTip"/>').css({height:40,width:e(window).width()-16,background:"rgba(0,0,0,.9)",border:"1px solid #1a1a1a",borderRadius:2,boxShadow:"0 0 2px #d1d1d1",position:"fixed",lineHeight:"40px",color:"#fff",margin:"8px",zIndex:12,textAlign:"center",top:0,left:0}).html('<img style="-webkit-animation: openapp 2 linear 1s;" width="14" height="14" src="http://m.baidu.com/static/search/inapp/openappdownload.png" />从顶部下拉，查看下载进度并安装');
e("#J_OpenAppKeyFrames").length||e("head").append('<style id="J_OpenAppKeyFrames"> @-webkit-keyframes openapp{ 0% { -webkit-transform: translate(0,0) } 25% { -webkit-transform: translate(0,4px) } 75% { -webkit-transform: translate(0,-4px) } 100% { -webkit-transform: translate(0,0);}} </style>'),e("#J_OpenAppTip").length?e("#J_OpenAppTip").show():e("body").append(t),n=setTimeout(function(){e("#J_OpenAppTip").hide()},3e3),window.localStorage[r.packageName]=1}window.openapp=window.openapp||{};var c,r,s,u=function(){},f=this,x={packageName:"",openAppUri:"",appInfo:"",lastestAppUri:"http://m.baidu.com/open/inapp?lcid=miia&callback=?",checkSuccess:void 0,checkError:void 0,popupHeaderText:"",downloadedPopupHeaderText:"",undownloadPopupBodyText:"请下载最新版V{version}（安装包{size}）",downloadedPopupBodyText:"",buttonText:["以后再说","确定下载"],clickNext:u,popupNext:u,downloadNext:u,cancelNext:u,openAppNext:u};
e("body").on("click",f.selector,function(n){n.preventDefault();var o=this,c=+new Date,u="packageName openAppUri popupHeaderText";r=e.extend(x,t||{}),e.each(r,function(n,t){-1!==u.indexOf(n)&&e.isFunction(t)&&(r[n]=t(o))}),s="http://127.0.0.1:6259/sendintent?intent="+window.encodeURIComponent(r.openAppUri)+"&t="+c,r.checkSuccess=r.checkSuccess||function(){r.openAppNext.call(null,o)},r.checkError=r.checkError||function(){a(function(n){p(r,n),r.popupNext.call(null,o),e("#J_OpenAppCancel").on("click",function(e){e.preventDefault(),i(),r.cancelNext.call(null,o)
}),e("#J_OpenAppOk").on("click",function(e){d(),e.preventDefault(),i(),r.downloadNext.call(null,o)})})},l(r.checkSuccess,r.checkError),r.clickNext.call(null,o)})}}(Zepto,window);