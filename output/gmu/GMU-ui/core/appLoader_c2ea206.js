(function(){function t(t,e){if(t||"object"==typeof t)for(var a in t)if(t.hasOwnProperty(a)&&0==e(t[a],a))return}function e(t){if(!this.errorInfo)throw new Error(t);this.errorInfo(t)}function a(e){var a=0;return t(e,function(t){a+=t.hash[0].charCodeAt()}),a}function n(t){var a,n=new XMLHttpRequest,o="GET",r=null,i=t.success||e;t.data&&(o="POST",r=t.data),n.open(o,t.url,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){(n.status>=200&&n.status<300||304===n.status)&&4===n.readyState&&(clearTimeout(a),i(h.parse(n.responseText)))
},n.send(r),a=setTimeout(function(){n.abort(),e("timeout to load file :"+v)},t.timeout||3e4)}function o(t,e){var a;1==e?(a=document.createElement("script"),a.innerHTML=t,l.insertBefore(a,l.firstChild)):(a=document.createElement("style"),a.type="text/css",a.innerHTML=t,l.appendChild(a))}function r(t,e){var a=v+"?type=proxy&name="+t+"&DEBUG=1";1==e?(node=document.createElement("script"),node.src=a,l.insertBefore(node,l.firstChild)):(node=document.createElement("link"),node.rel="stylesheet",node.href=a,l.appendChild(node))
}function i(t,e,a){var o="hash="+t+"&sum="+e+(a||"");n({url:v+"?type=data",data:o,success:u})}function s(e,n){if(e.path)return void t(e.path,function(t){r(t.name,t.type)});var o=e.list,s=d("appHash",e.hash);if(n)o=d("appData",h.stringify(o)),i(s,"");else if(o&&o.length){var u,f,l=[],m=a(o),y=p("appData");t(o,function(e){u=e.hash,f=!1,t(y,function(t){return t.hash==u?(e.data=t.data,f=!0,!1):void 0}),f||l.push("&diff[]="+u)}),d("appData",h.stringify(o)),i(s,m,l.join(""))}else c()}function u(e){var a=p("appData"),n=e.list;
t(n,function(e,n){t(a,function(t){t.hash==n&&(t.data=e)})}),d("appHash",e.hash),c(a)}function c(e){e?d("appData",h.stringify(e)):e=p("appData"),t(e,function(t){o(t.data,t.type)})}function p(t){var e=f[t];return"appData"==t&&e?h.parse(e):e}function d(t,e){try{return f[t]=e}catch(a){}}var f=this.localStorage,h=this.JSON,l=document.head||document.getElementsByTagName("head")[0],m=!!document.documentElement.getAttribute("manifest"),y=/DEBUG=1;/.test(document.cookie),v="http://bb-ikonw-test06.vm.baidu.com:8089/webapp";
this.load=function(t){var e=p("appHash"),o=p("appData");e?m?(o="hash="+e+"&sum="+a(o),y&&(o+="&DEBUG=1"),n({url:v+"?type=list",data:o,success:s})):s(t):s(t,!0)}}).call(this);