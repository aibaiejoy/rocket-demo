!function(t){t.ui.create("toolbar",{_data:{titleText:"",buttonText:"返回",buttonClick:function(){history.back(1)},buttonCorner:{borderColor:"rgb(164, 164, 164)",backgroundColor:{from:"#FEFEFE",to:"#ECECEC"}},iconMax:4,showMore:2,isShow:!0,onverticalswipe:function(){}},_create:function(){{var a=this,o=a.widget(),e=t(a.data("container")||document.body),i="",r=a.data("tools")||[];a.data("iconMax")||2}if(tmpA=[],o){if(a.data("instanceId")&&o.addClass(a.data("instanceId")),i+='<div class="ui-toolbar">',i+=a._createButton(),i+=a._createTitle(),2==a.data("showMore"))i+="</div>",i+=a._createSubTools();
else{for(var n=0;n<r.length;n++)n>=a.data("iconMax")?(tmpA.push(r[n]),n==r.length-1&&(i+='<div class="ui-toolbar-btn ui-toolbar-more"></div>')):i+='<div data-index="'+n+'" class="ui-toolbar-btn '+(r[n].classN||"")+'"></div>',tmpA.length&&a.data("moreTools",tmpA);i+="</div>"}o.html(i),o.parent().length||o.appendTo(e)}a.data("isShow")||o.hide(),a.trigger("create")},_createButton:function(){var t=this,a="";return a+='<div class="ui-toolbar-backcon">',a+='<div class="ui-toolbar-backbtn">',a+='<canvas id="ui-toolbar-leftcorner"></canvas>',a+='<span class="ui-toolbar-content">',a+=t.data("buttonText"),a+="</span>",a+="</div>",a+="</div>"
},_createTitle:function(){var t=this,a="";return a+='<div class="ui-toolbar-title">',t.data("titleText")&&(a+=t.data("titleText")),a+="</div>"},_createSubTools:function(){var t=this,a="",o=t.data("tools")||[];a+='<div class="ui-sub-toolbar">';for(var e=0;e<o.length;e++)a+='<div data-index="'+e+'" class="ui-toolbar-btn '+(o[e].classN||"")+'"></div>';return a+="</div>"},_changeFormatForDropMenu:function(){var t=this,a=t.data("moreTools"),o=[{text:'<div data-index="more" class="more"></div>'}];if(!a||!a.length)return[];
for(var e=0;e<a.length;e++){var i={text:'<div class="ui-toolbar-btn '+(a[e].classN||"")+'"></div>',callback:a[e].click};o.push(i)}return o},_init:function(){var a=this,o=a.data("tools")||[],e=a.widget();t(".ui-toolbar-backcon",e).on("click",a.data("buttonClick")),t(".ui-toolbar-btn",e).each(function(){var a=t(this).attr("data-index"),e=o[a];e&&t(this).on("click",e.click)}),e.on("touchstart touchmove touchend",function(t){a._eventHandler(t)}),t(document).on("click",function(t){var o=t.bubblesList;
a[!o||o.indexOf(a)>-1?"show":"hide"]()}),a.trigger("init")},_eventHandler:function(t){var a=this,o=(a.widget(),t.targetTouches[0]);switch(t.type){case"touchstart":a.data("touchStartX",o.pageX||0),a.data("touchStartY",o.pageY||0);break;case"touchmove":var e=o.pageX-a.data("touchStartX"),i=o.pageY-a.data("touchStartY");a.data("touchMoveXL",e),a.data("touchMoveYL",i);break;case"touchend":Math.abs(a.data("touchMoveXL"))<Math.abs(a.data("touchMoveYL"))&&a.trigger("verticalswipe",t)}},_drawReturnLeftCorner:function(){var a=this,o={height:32,width:16,lineWidth:2},e=a.data("buttonCorner");
t("#ui-toolbar-leftcorner").attr({height:o.height+"px",width:o.width+o.lineWidth+"px",style:"position:absolute;top:-1px;left:-15px;z-index:-1;"});var i=document.getElementById("ui-toolbar-leftcorner"),r=i.getContext("2d");r.beginPath(),r.strokeStyle=e.borderColor,r.lineWidth=o.lineWidth,r.moveTo(o.width,0),r.lineTo(0+o.lineWidth,o.height/2),r.lineTo(o.width,o.height),r.lineJoin="round",r.stroke(),r.closePath();var n=r.createLinearGradient(0,0,0,o.height);n.addColorStop(0,e.backgroundColor.from),n.addColorStop(1,e.backgroundColor.to),r.fillStyle=n,r.fill()
},show:function(){var t=this,a=t.widget();return t.isDraw||(t.isDraw=!0,t._drawReturnLeftCorner()),t.data("isShow")||(t.trigger("beforeshow"),t.data("isShow",!0),a.show(),t.trigger("aftershow")),t},hide:function(){var t=this,a=t.widget();return t.data("isShow")&&(t.data("isShow",!1),t.trigger("beforehide"),a.hide(),t.trigger("afterhide")),t},buttonText:function(){var a=this,o=a.widget();return void 0!=arguments[0]?(a.data("buttonText",arguments[0]),t(".ui-toolbar-backbtn .ui-toolbar-content",o).text(arguments[0]),a):a.data("buttonText")
},titleText:function(){var a=this,o=a.widget();return void 0!=arguments[0]?(a.data("titleText",arguments[0]),t(".ui-toolbar-title",o).text(arguments[0]),a):a.data("titleText")}}).attach("control.fix"),t.ui.register("toolbar",function(){var a=this,o=a._changeFormatForDropMenu();o.length&&a.data("dropmenu",t.ui.dropmenu('<div class="ui-dropmenu"></div>',{container:t(".ui-toolbar-more",a.widget()),hasArrow:!1,content:o,offset:0}))})}(Zepto);