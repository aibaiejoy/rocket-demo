!function(t){t.ui.create("dropmenu",{_data:{content:[],container:"",mode:"default",offset:0,instanceId:"",hasArrow:!1,position:"default",callback:"",isScroll:!1},_create:function(){var e=this,a=e.data("instanceId"),s=t(e.data("container")||document.body),o=e.widget(),i=o||e.widget(t('<div class="ui-dropmenu"></div>')),n=e.data("arrow",t('<span class="ui-dropmenu-arrow"></span>')),d=e.data("title",t('<span class="ui-dropmenu-title">'+e.data("content")[0].text+"</span>")),r=e.data("button",t('<div class="ui-dropmenu-button"></div>')),l=e.data("menu",t('<div class="ui-dropmenu-content"></div>'));
if(e.data("uiArrow",t('<span class="ui-dropmenu-content-arrow"></div>')).appendTo(l),!o&&a&&i.addClass(a),r.append(d),i.css("position","relative").append(r),i.append(l),l.css("visibility","hidden"),e._createmenu(),e.data("hasArrow")&&r.append(n),i.parent().get(0)||i.appendTo(s),"horizontal"==e.data("position")){var c=e.data("items"),u=c.children(),h=0;c.addClass("horizontal"),t.each(t(u),function(e,a){h+=t(a).offset().width}),c.css({"float":"left"}),c.parent().css("width",h+"px"),e.data("isScroll")&&t(".scrollBox",l).css("height",c.offset().height+"px")
}e._setOffset(),l.css("visibility","visible"),l.hide(),e.trigger("create")},_init:function(){{var e=this,a=e.data("button"),s=e.data("menu"),o=e.data("arrow"),i=(e.data("title"),e.data("content")),n=(i.length,e.data("items")),d=n.children();e.data("callback"),e.widget()}e.data("menuOffset",s.offset()),a.on("touchstart",function(){o&&o.toggleClass("ui-dropmenu-arrow-on"),e.setOffset(),s.toggle(),e._resetScroll()}),e.data("isScroll")||d.on("touchstart",function(t){setTimeout(function(){e._menuEvent(t)
},100)});var r=t.bind(e._eventHandler,e);t(window).on("resize",r),t(document).on("touchstart",r),e.data("isScroll")&&t(document).on("DOMContentLoaded",r),e.on("destroy",function(){t(window).off("resize",r),t(document).off("touchstart",r),t(document).off("DOMContentLoaded",r)}),e.trigger("init")},_eventHandler:function(t){var e=this;switch(t.type){case"resize":setTimeout(function(t){e.setOffset(t)},300);break;case"click":case"touchstart":e._isClose(t);break;case"DOMContentLoaded":setTimeout(e.data("scroll"),200)
}},_isClose:function(t){var e=this,a=t.bubblesList;a&&-1!=a.indexOf(e)||e.hide()},_menuEvent:function(e){var a=this,s=t(e.target),o=a.data("index"),i=a.data("title"),n=i.html(),d=a.data("callback"),r=a.data("mode"),l=a.data("content"),c=l.length,u=a.data("items"),h=a.data("arrow"),f=a.data("menu"),p=u.children();s=s.closest("li");var m=s.index();m=c-1>m?m:c-1,l[m].callback?l[m].callback(m,s,a):t.isFunction(d)&&d(m,s,a),"selected"==r&&(s.hide(),i.html(s.html()),0==o?p.first().html(n).show():t(p.get(o)).show(),h&&h.toggleClass("ui-dropmenu-arrow-on"),f.hide(),a.trigger("select")),a.data("index",s.index())
},_createmenu:function(){var e=this,a=e.data("content"),s=e.data("menu"),o=[],i=e.data("items",t('<ul class="ui-dropmenu-items"></ul>'));t.each(a,function(t){var e=a[t].className?'class="'+a[t].className+'"':"";t>0&&o.push("<li "+e+">"+a[t].text+"</li>")}),e.data("index",0),e.data("length",o.length),e.data("isScroll")?(s.append('<div class="scrollBox"><div class="scroller"></div></div>'),t(".scroller",s).append(i)):s.append(i),i.html('<li style="display:none;"></li>'+o.join(""))},_scroll:function(){var e=this,a=t(".scrollBox",e.data("menu")).get(0),s="horizontal"==e.data("position")?!0:!1,o="horizontal"!=e.data("position")?!0:!1,i=new iScroll(a,{hScroll:s,vScroll:o,onTouchEnd:function(t){this.moved||this.absDistY||e._menuEvent(t)
}});e.data("scroll",i)},show:function(){var t=this,e=t.data("arrow");return t.setOffset(),t.data("menu").show(),e&&e.addClass("ui-dropmenu-arrow-on"),t._resetScroll(),t.trigger("show"),t},hide:function(){var t=this,e=t.data("arrow");return t.data("menu").hide(),e&&e.removeClass("ui-dropmenu-arrow-on"),t.trigger("hide"),t},_setOffset:function(){var t=this,e=t.data("menu"),a=t.data("uiArrow"),s=document.body.clientWidth,o=document.documentElement.clientHeight,i=document.body.offsetHeight,n=o>i?o:i,d=t.data("offset"),r=d.x?d.x:0,l=d.y?d.y:d,d=t.data("button").offset(),c=e.offset();
e.css("top",d.height-1+l+"px"),a.css({left:c.width/2-6+"px",top:"-7px"}).removeClass("ui-dropmenu-content-arrowbottom"),e.css("left",-(c.width-d.width)/2+r+"px"),d.left<c.width/2?(e.css("left",0+r+"px"),a.css("left",d.width/2-6+"px")):s-d.width-d.left<(c.width-d.width)/2&&(e.css("left",-(c.width-d.width)+r+"px"),a.css("left",c.width-d.width/2-6+"px")),n-d.height-d.top-l<c.height&&(e.css("top",-(c.height-1+l)+"px"),a.css("top",c.height-1+"px").addClass("ui-dropmenu-content-arrowbottom")),t._resetScroll()
},_resetScroll:function(){var t=this;!t.data("scroll")&&t.data("isScroll")?t._scroll():t.data("scroll")&&t.data("scroll").refresh()},setOffset:function(){var t=this,e=!1,a=t.data("menu");return"none"==a.css("display")&&(a.css("visibility","hidden").show(),e=!0),t._setOffset(),e&&a.hide().css("visibility","visible"),t},destroy:function(){var t=this;t.widget().off(),t.data("scroll")&&t.data("scroll").destroy(),t._super()}})}(Zepto);