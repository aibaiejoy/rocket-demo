!function(t,a){t.ui.create("suggestion",{_data:{listCount:50,isCache:!0,isStorage:!0,minChars:0,maxChars:1e3,offset:{x:0,y:0,w:0},confirmClearHistory:!0},_create:function(){var a=this,e=+new Date,i="ui-input-mask-"+e,n=a.data("id","ui-suggestion-"+t.guid()),s=a.data("input",t(a.data("container"))).attr("autocomplete","off"),o=s.parent();a.data("inputWidth",s.get(0).offsetWidth),a.data("cacheData",{}),"ui-input-mask"!=o.attr("class")&&(o=t('<div id="'+i+'" class="ui-input-mask"></div>').appendTo(s.parent()).append(s)),a.data("maskElem",o),a.widget(t('<div id="'+n+'" class="ui-suggestion"><div class="ui-suggestion-content"><div class="ui-suggestion-scroller"></div></div><div class="ui-suggestion-button"></div></div>').appendTo(o)),a._initSuggestionOffset().trigger("create")
},_init:function(){var a=this,e=a.data("input"),i=t.bind(a._eventHandler,a);a.widget().on("touchstart",i),e.on("focus input",i).parent().on("touchstart",i),t(window).on("ortchange",i),a.data("autoClose")&&t(document).on("tap",i),a.on("destroy",function(){t(document).off("tap",i),t(window).off("ortchange",i)}),a.trigger("init")},_initSuggestionOffset:function(){var t=this,a=t.widget(),e=t.data("input"),i=t.data("offset"),n=2*parseInt(a.css("border-left-width")||0);return t.data("pos",e.height()+(i.y||0)),t.data("realWidth",(t.data("width")||e.width())-n),a.css({position:"absolute",left:i.x||0}),t
},_setSize:function(){{var t=this;t.data("realWidth"),t.data("input").parent().width()-t.data("inputWidth")}return t},_posAdapt:function(a){var e=this;return a?e._setPos().data("timeId",t.later(function(){e._setPos()},200,!0)):clearInterval(e.data("timeId")),e},_setPos:function(){var a=this,e=a.widget(),i=a.data("input"),n=parseFloat(e.height()),s=a.data("offset"),o=parseFloat(a.data("pos")),r=i.offset(!0).top,d=t(window).height()-i.offset(!0).bottom;return a.data("posAdapt")&&r>d?e.css("top",-n-(s.y||0)+"px"):e.css("top",o),a
},_change:function(t){{var a=this,e=a._cacheData(t),i=a.data("isCache");a.data("source")}return e&&i?a._render(t,e):a._sendRequest(t)},_eventHandler:function(t){var a=this,e=t.type,i=t.target,n=a.data("maskElem").get(0);switch(e){case"focus":a._setSize()._showList()._setPos().trigger("open");break;case"touchstart":case"mousedown":if(!t.formDelete)break;t.preventDefault();case"input":a._showList();break;case"ortchange":a._setSize()._setPos();break;case"click":case"tap":16&n.compareDocumentPosition(i)||a.hide()
}},_showList:function(){var t=this,a=t.getValue(),e=t._localStorage();return a.length<parseFloat(t.data("minChars"))||a.length>parseFloat(t.data("maxChars"))?t.hide():a?t._change(a):e?t._render(null,{s:e.split(",")}):t.hide()},_bindSuggestionListEvent:function(){var t=this;return t.widget().find(".ui-suggestion-result").on("click",function(){t._select(this)._submit()}).highlight("ui-suggestion-result-highlight"),t},_bindCloseEvent:function(){var a=this;return t(".ui-suggestion-button span:first-child").on("click",function(){t.later(function(){a.clearHistory()
},t.os.android?200:0)}),t(".ui-suggestion-button span:last-child").on("click",function(){a.hide().leaveInput().trigger("close")}),a},_sendRequest:function(a){var e=this,i=e.data("source"),n=e.data("param"),s="suggestion_"+ +new Date,o=e.data("sendRequest");return t.isFunction(o)?o(a,function(t){e._render(a,t)._cacheData(a,t)}):a&&(i+=(-1===i.indexOf("?")?"?":"")+"&wd="+encodeURIComponent(a),-1===i.indexOf("&cb=")&&(i+="&cb="+s),n&&(i+="&"+n),window[s]=function(n){e._render(a,n)._cacheData(a,n),t('[src="'+i+'"]').remove(),delete window[s]
},t.ajaxJSONP({url:i,dataType:"json"})),e},getValue:function(){return t.trim(this.data("input").val())},_render:function(t,a){var e,i=this,n=i.widget(),s=n.find(".ui-suggestion-content"),o=n.find(".ui-suggestion-button"),r=i.data("renderList"),d=i.data("renderEvent"),u='<span style="display:none;"></span><span>关闭</span>';if(null===t&&(u="<span>清除历史记录</span><span>关闭</span>"),e=r?r.apply(i,[t,a]):i._renderList(t,a)){s.find("*").off(),s.find(".ui-suggestion-scroller").html(e),o.find("*").off(),o.html(u),d?d.apply(i):i._bindSuggestionListEvent(),+a.s.length>=2?s.css("height",i.data("height")||80):s.css("height",40),i._bindCloseEvent()._show();
var c=i.data("iScroll")||i.data("iScroll",new iScroll(s.get(0),{topOffset:0,hScroll:!1}));c.scrollTo(0,0),c.refresh()}else i.hide();return i},_buildHTML:function(t){var a=t.join('</div></li><li><div class="ui-suggestion-result">');return'<ul><li><div class="ui-suggestion-result">'+a+"</div></li></ul>"},_renderList:function(a,e){var i=this,n=(i.widget(),i.data("listCount")),s=[],o=e.s;return e&&o&&o.length?(o=o.slice(0,n),t.each(o,function(e,i){t.trim(i)&&s.push(""!=a?i.replace(a,"<span>"+a+"</span>"):i)
}),i._buildHTML(s)):void i.hide()},_submit:function(){var t=this,a=t.data("input").val();return t.trigger("submit"),t.data("onsubmit")||t._callbacks&&t._callbacks.submit||(window.location="http://www.baidu.com/s?wd="+encodeURIComponent(a)),t},_select:function(t){var a=this,e=t.textContent;return a.data("input").val(e),a.data("isStorage")&&a._localStorage(e),a.trigger("select",t).hide()},_cacheData:function(t,e){var i=this;return e!==a?i.data("cacheData")[t]=e:i.data("cacheData")[t]},_localStorage:function(e){var i=this,n=i.data("shareName"),s=i.data("isSharing")?n?n+"-SUG-Sharing-History":"SUG-Sharing-History":i.data("id");
if(null===e)window.localStorage[s]="";else if(e!==a){var o=window.localStorage[s],r=o?o.split(","):[];if(-1!=t.inArray(e,r))return;r.unshift(e),window.localStorage[s]=r.join(",")}return window.localStorage[s]},_show:function(){var t=this;return t.data("hideTimer")&&(clearTimeout(t.data("hideTimer")),t.data("hideTimer",null)),t.widget().css("display","block"),t.data("posAdapt")&&t._posAdapt(1),t.trigger("show")},hide:function(){var a=this;return a.data("hideTimer",t.later(function(){a.widget().css("display","none"),a.data("hideTimer",null)
},200)),a._posAdapt(0).trigger("hide")},clearHistory:function(){var t=this,a=function(){t._localStorage(null),t.hide()};t.data("confirmClearHistory")?window.confirm("清除全部查询历史记录？")&&a():a()},history:function(t){return this._localStorage(t)},focusInput:function(){return this.data("input").get(0).focus(),this},leaveInput:function(){return this.data("input").get(0).blur(),this},destroy:function(){var t=this,a=t.data("maskElem");clearTimeout(t.data("timeId")),clearTimeout(t.data("resId")),clearTimeout(t.data("hideTimer")),a.find("*").off(),t.data("iScroll")&&t.data("iScroll").destroy(),t._super(),a.off().remove()
}}),t(document).on("pageInit",function(){t("[data-widget=suggestion]").each(function(a,e){var i=t(e),n=i.attr("data-source"),s=i.attr("data-listCount");t.ui.suggestion({container:e,source:n,listCount:s})})})}(Zepto);