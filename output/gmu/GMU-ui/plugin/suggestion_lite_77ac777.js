!function(t,a){t.ui.create("suggestion",{_data:{listCount:50,isCache:!0,isStorage:!0,minChars:0,maxChars:1e3,offset:{x:0,y:0,w:0},confirmClearHistory:!0},_create:function(){var a=this,i=+new Date,e="ui-input-mask-"+i,n=a.data("id","ui-suggestion-"+t.guid()),s=a.data("input",t(a.data("container"))).attr("autocomplete","off"),o=s.parent();a.data("inputWidth",s.get(0).offsetWidth),a.data("cacheData",{}),"ui-input-mask"!=o.attr("class")&&(o=t('<div id="'+e+'" class="ui-input-mask"></div>').appendTo(s.parent()).append(s)),a.data("maskElem",o),a.widget(t('<div id="'+n+'" class="ui-suggestion"><div class="ui-suggestion-content"><div class="ui-suggestion-scroller"></div></div><div class="ui-suggestion-button"></div></div>').appendTo(o)),a._initSuggestionOffset().trigger("create")
},_init:function(){var a=this,i=a.data("input"),e=t.bind(a._eventHandler,a);a.widget().on("touchstart",e),i.on("focus input",e).parent().on("touchstart",e),t(window).on("ortchange",e),a.data("autoClose")&&t(document).on("tap",e),a.on("destroy",function(){t(document).off("tap",e),t(window).off("ortchange",e)}),a.trigger("init")},_initSuggestionOffset:function(){var t=this,a=t.widget(),i=t.data("input"),e=t.data("offset"),n=2*parseInt(a.css("border-left-width")||0);return t.data("pos",i.height()+(e.y||0)),t.data("realWidth",(t.data("width")||i.width())-n),a.css({position:"absolute",left:e.x||0}),t
},_setSize:function(){var t=this,a=t.data("realWidth"),i=t.data("input").parent().width()-t.data("inputWidth");return t.widget().css("width",a+i),t},_posAdapt:function(a){var i=this;return a?i._setPos().data("timeId",t.later(function(){i._setPos()},200,!0)):clearInterval(i.data("timeId")),i},_setPos:function(){var a=this,i=a.widget(),e=a.data("input"),n=parseFloat(i.height()),s=a.data("offset"),o=parseFloat(a.data("pos")),r=e.offset(!0).top,d=t(window).height()-e.offset(!0).bottom;return a.data("posAdapt")&&r>d?i.css("top",-n-(s.y||0)+"px"):i.css("top",o),a
},_change:function(t){{var a=this,i=a._cacheData(t),e=a.data("isCache");a.data("source")}return i&&e?a._render(t,i):a._sendRequest(t)},_eventHandler:function(t){var a=this,i=t.type,e=t.target,n=a.data("maskElem").get(0);switch(i){case"focus":a._setSize()._showList()._setPos().trigger("open");break;case"touchstart":case"mousedown":if(!t.formDelete)break;t.preventDefault();case"input":a._showList();break;case"ortchange":a._setSize()._setPos();break;case"click":case"tap":16&n.compareDocumentPosition(e)||a.hide()
}},_showList:function(){var t=this,a=t._getValue(),i=t._localStorage();return a.length<parseFloat(t.data("minChars"))||a.length>parseFloat(t.data("maxChars"))?t.hide():a?t._change(a):i?t._render(null,{s:i.split(",")}):t.hide()},_bindSuggestionListEvent:function(){var t=this;return t.widget().find(".ui-suggestion-result").on("click",function(){t._select(this)._submit()}).highlight("ui-suggestion-result-highlight"),t},_bindCloseEvent:function(){var a=this;return t(".ui-suggestion-button span:first-child").on("click",function(){t.later(function(){a.clearHistory()
},t.os.android?200:0)}),t(".ui-suggestion-button span:last-child").on("click",function(){a.hide().leaveInput().trigger("close")}),a},_sendRequest:function(a){var i=this,e=i.data("source"),n=i.data("param"),s="suggestion_"+ +new Date,o=i.data("sendRequest");return t.isFunction(o)?o(a,function(t){i._render(a,t)._cacheData(a,t)}):a&&(e+=(-1===e.indexOf("?")?"?":"")+"&wd="+encodeURIComponent(a),-1===e.indexOf("&cb=")&&(e+="&cb="+s),n&&(e+="&"+n),window[s]=function(n){i._render(a,n)._cacheData(a,n),t('[src="'+e+'"]').remove(),delete window[s]
},t.ajaxJSONP({url:e,dataType:"json"})),i},_getValue:function(){return t.trim(this.data("input").val())},_render:function(t,a){var i,e=this,n=e.widget(),s=n.find(".ui-suggestion-content"),o=n.find(".ui-suggestion-button"),r=e.data("renderList"),d=e.data("renderEvent"),u='<span style="display:none;"></span><span>关闭</span>';return null===t&&(u="<span>清除历史记录</span><span>关闭</span>"),i=r?r.apply(e,[t,a]):e._renderList(t,a),i?(s.find("*").off(),s.find(".ui-suggestion-scroller").html(i),o.find("*").off(),o.html(u),d?d.apply(e):e._bindSuggestionListEvent(),e._bindCloseEvent()._show()):e.hide(),e
},_buildHTML:function(t){var a=t.join('</div></li><li><div class="ui-suggestion-result">');return'<ul><li><div class="ui-suggestion-result">'+a+"</div></li></ul>"},_renderList:function(a,i){var e=this,n=(e.widget(),e.data("listCount")),s=[],o=i.s;return i&&o&&o.length?(o=o.slice(0,n),t.each(o,function(i,e){t.trim(e)&&s.push(""!=a?e.replace(a,"<span>"+a+"</span>"):e)}),e._buildHTML(s)):void e.hide()},_submit:function(){var t=this,a=t.data("input").val();return t.trigger("submit"),t.data("onsubmit")||t._callbacks&&t._callbacks.submit||(window.location="http://www.baidu.com/s?wd="+encodeURIComponent(a)),t
},_select:function(t){var a=this,i=t.textContent;return a.data("input").val(i),a.data("isStorage")&&a._localStorage(i),a.trigger("select",t).hide()},_cacheData:function(t,i){var e=this;return i!==a?e.data("cacheData")[t]=i:e.data("cacheData")[t]},_localStorage:function(i){var e=this,n=e.data("shareName"),s=e.data("isSharing")?n?n+"-SUG-Sharing-History":"SUG-Sharing-History":e.data("id");if(null===i)window.localStorage[s]="";else if(i!==a){var o=window.localStorage[s],r=o?o.split(","):[];if(-1!=t.inArray(i,r))return;
r.unshift(i),window.localStorage[s]=r.join(",")}return window.localStorage[s]},_show:function(){var t=this;return t.data("hideTimer")&&(clearTimeout(t.data("hideTimer")),t.data("hideTimer",null)),t.widget().css("display","block"),t.data("posAdapt")&&t._posAdapt(1),t.trigger("show")},hide:function(){var a=this;return a.data("hideTimer",t.later(function(){a.widget().css("display","none"),a.data("hideTimer",null)},200)),a._posAdapt(0).trigger("hide")},clearHistory:function(){var t=this,a=function(){t._localStorage(null),t.hide()
};t.data("confirmClearHistory")?window.confirm("清除全部查询历史记录？")&&a():a()},history:function(t){return this._localStorage(t)},focusInput:function(){return this.data("input").get(0).focus(),this},leaveInput:function(){return this.data("input").get(0).blur(),this},destroy:function(){var t=this,a=t.data("maskElem");clearTimeout(t.data("timeId")),clearTimeout(t.data("resId")),clearTimeout(t.data("hideTimer")),a.find("*").off(),t._super(),a.off().remove()}}),t(document).on("pageInit",function(){t("[data-widget=suggestion]").each(function(a,i){var e=t(i),n=e.attr("data-source"),s=e.attr("data-listCount");
t.ui.suggestion({container:i,source:n,listCount:s})})})}(Zepto);