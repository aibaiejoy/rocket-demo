!function(t){t.ui.create("carousel",{_data:{num:0,select:0,imgClip:!1,autoPlay:!1,autoPlayTime:5e3,animationTime:300,springBack:!1,springBackDis:50,boundSpring:!0,loop:!1,showDot:!0,showArr:!0,arrTop:37,useDefaultTpl:!0,initTpl:null,flipTpl:null,forceInitTpl:!1,slideFn:null,slideEndFn:null},_create:function(){this._initProperty()._createUI()._initPage().trigger("create")},_init:function(){var a=this;a._eventHandler(),0!=a.select&&a.select<a.num&&a.slideTo(a.select);var e=t.bind(a._resize,a),i="onorientationchange"in window?"orientationchange":"resize";
t(window).on(i,e),a.data("_resize",e),a.trigger("init")},_initProperty:function(){{var t=this;t.widget()}return t.data({_index:0,_cur:0,_dir:1,_autoplayInterval:null,_slideDis:0}),t.data("useDefaultTpl")&&t.data("num",t.data("content").length),1==t.data("num")&&t.data({autoPlay:!1,showDot:!1,showArr:!1}),t},_initPage:function(){var t=this,a=t.data("loop"),e=t.data("num");if(1==e)t._setItemData(0,0,!0);else for(var i=a?1:0,n=0;3>n;n++)t._setItemData(n,n-i,!0);return t},_eventHandler:function(){var a,e,i,n,r,s,o=this,d=o.data("_panel"),l=o.data("loop"),u=o.data("autoPlay");
return t(d).on("touchstart",function(t){s=!1,o._setContainerWidth()._removePanelTransition(),t.touches&&(a=[t.touches[0].clientX,t.touches[0].clientY]),o.removeAutoPlay()}).on("touchmove",function(t){var c=o.data("_cur"),_=o.data("num"),p=o.data("_index"),h=o.data("_containerWidth");t.touches&&(e=[t.touches[0].clientX,t.touches[0].clientY],i=a[0]-e[0],n=a[1]-e[1]),s?r&&(!l&&(0>i&&0==c||i>=0&&c==_-1)?o.data("boundSpring")&&o._setTranslate(d,-(c*h+i/2)+"px"):o._setTranslate(d,-(p*h+i)+"px"),t.preventDefault()):(s=!0,r=Math.abs(n)<Math.abs(i),r?t.preventDefault():u&&o.addAutoPlay())
}).on("touchend",function(){{var t=o.data("_cur"),a=o.data("num");o.data("_index"),o.data("_containerWidth")}if(u&&o.addAutoPlay(),s&&r){"number"!=typeof i&&(i=0);var e=1-Math.abs(i)/o.data("_containerWidth");return o.data("_slideDis",i),!l&&(0>i&&0==t||i>=0&&t==a-1)?void o.curr(1-e):o.data("springBack")&&Math.abs(i)<o.data("springBackDis")?void o.curr(1-e):void(0>i?o.pre(e):i>0?o.nex(e):o.curr(1-e))}}).on("webkitTransitionEnd",function(){a=e=[],i=n=0,o.trigger("slideEnd",o.data("_cur"))}).on("click",function(){u&&o.addAutoPlay(),o.trigger("click",o.data("_cur"))
}),u&&o.addAutoPlay(),o},_resize:function(){var a=this,e=a.data("_panel"),i=t.os.android?1e3:0;setTimeout(function(){a._setContainerWidth(),!t.os.ios&&a._setTranslate(e,-a.data("_index")*a.data("_containerWidth")+"px")},i)},_createUI:function(){var a,e,i,n,r=this,s=r.widget(),o=r.data("num"),d=r.data("loop"),l=t(r.data("container")||document.body)[0];if(r.data("setup")){var u=s.find(".ui-carousel-item");a=s.find(".ui-carousel-wrap"),e=u.eq(0),i=u.eq(1),n=u.eq(2)}else a=t('<div class="ui-carousel-wrap"></div>'),e=t('<div class="ui-carousel-item"></div>'),i=t('<div class="ui-carousel-item"></div>'),n=t('<div class="ui-carousel-item"></div>');
if(s=s?s.addClass("ui-carousel"):r.widget(t("<div></div>")).addClass("ui-carousel"),3>o&&r.data("loop",!1),r.data("loop")?r._setTranslate(e,"-100%")._setTranslate(i,"0%")._setTranslate(n,"100%"):r._setTranslate(e,"0%")._setTranslate(i,"100%")._setTranslate(n,"200%"),s.append(a.append(e).append(i).append(n)),l.appendChild(r.widget().get(0)),r.data("useDefaultTpl")&&r.data("forceInitTpl",!0)){var c=r.data("content"),_=r.data("imgClip"),p=r.data("imgInit");r.data("initTpl",function(t){var a=[];return a.push('<div class="ui-carousel-page"><a class="ui-carousel-link" href="'+(c[t].href||"javascript:;")+'">'),_?r._imgClip(c[t].pic,a,t):a.push(d?'<img class="ui-carousel-image" src="'+c[t].pic+'"/>':!d&&(!p||p>t||t>2)?'<img class="ui-carousel-image" src="'+c[t].pic+'"/>':'<img class="ui-carousel-image" pre="'+c[t].pic+'"/>'),(c[t].title||c[t].subTitle)&&(a.push('<div class="ui-carousel-info">'),c[t].title&&a.push('<p class="ui-carousel-title1">'+c[t].title+"</p>"),c[t].subTitle&&a.push('<p class="ui-carousel-title2">'+c[t].subTitle+"</p>"),a.push("</div>")),a.push("</a></div>"),a.join("")
})}if(r.data("showDot")){var h=r._createDots();r.data("_dot",new h({num:r.data("num")})),l.appendChild(r.data("_dot").container)}if(r.data("showArr")){var m=r.data("arrTop");$larr=t('<a class="ui-carousel-lArr" style="top:'+m+'px"></a>'),$rarr=t('<a class="ui-carousel-rArr" style="top:'+m+'px"></a>'),$larr.on("click",function(){r.pre()}),$rarr.on("click",function(){r.nex()}),l.appendChild($larr.get(0)),l.appendChild($rarr.get(0)),r.data("$larr",$larr.get(0)),r.data("$rarr",$rarr.get(0))}return r.data("_container",r.widget().get(0)),r.data("_panel",a.get(0)),r.data("_items",[e.get(0),i.get(0),n.get(0)]),r.num<3&&n.css("display","none"),r.num<2&&i.css("display","none"),r._setContainerWidth()._addPanelTransition()
},_imgClip:function(a,e,i){var n=this,r=new Image;r.src=a,e.push('<div class="ui-carousel-clip" data-clip="'+i+'"><img class="ui-carousel-image" src="'+a+'"/></div>'),r.onload=function(){r.onload=null;var a=r.width/r.height,e=n.widget(),s=t('[data-clip="'+i+'"]'),o=s.children("img"),d=e.height(),l=e.width(),u=l/d;a>u?r.height>d&&o.css({height:"100%",display:"block"}).removeClass("ui-carousel-image"):r.width>l&&o.css({width:"100%",display:"block"}).removeClass("ui-carousel-image")}},_createDots:function(){var a=function(t){this.select=t.selectIndex||0,this.num=t.num,this.container=null,this.dots=[],this.init()
};return a.prototype={init:function(){this.initDom()},initDom:function(){for(var a=t('<div class="ui-carousel-dots"></div>'),e=0;e<this.num;e++){var i=t('<div class="ui-carousel-dot"></div>');e==this.select&&i.addClass("ui-carousel-dot-select"),a.append(i),this.dots.push(i.get(0))}this.container=a.get(0)},selectDot:function(a){a!=this.select&&(t(this.dots[this.select]).removeClass("ui-carousel-dot-select"),t(this.dots[a]).addClass("ui-carousel-dot-select"),this.select=a)}},a},_setTranslate:function(a,e,i,n){return t(a).css("-webkit-transform","translate3d("+(e||0)+","+(i||0)+","+(n||0)+")"),this
},_setContainerWidth:function(){var a=this;return a.data("_containerWidth",t(a.data("_container")).width()),a},_addPanelTransition:function(a){var e=this;return"number"!=typeof a&&(a=1),t(e.data("_panel")).css({"-webkit-transition-duration":parseInt(a*e.data("animationTime"))+"ms","-webkit-transition-timing-function":"linear"}),e},_removePanelTransition:function(){var a=this;return t(a.data("_panel")).css({"-webkit-transition-duration":"","-webkit-transition-timing-function":""}),a},_getCurrentTrans:function(t){var a=this,e=a.data("num");
return a.data("loop")?[3*Math.floor((t+2)/3)-1,3*Math.floor((t+1)/3),3*Math.floor(t/3)+1]:0==t||2==e?[0,1,2]:(t==e-1&&(t=e-2),[3*parseInt((t+1)/3),3*parseInt((t+3)/3)-2,3*parseInt((t+2)/3)-1])},_getCurSeq:function(t){var a=this,e=a.data("num");return a.loop?[t%3,(t+1)%3,(t+2)%3]:0==t?[0,1,2]:(t==e-1&&(t=e-2),[(t-1)%3,t%3,(t+1)%3])},_setItemPos:function(a){var e=this,i=e.data("_items"),n=e.data("_panel"),r=e._getCurrentTrans(a),s=t(".ui-carousel-image",e.widget()).eq(a);return s.attr("pre")&&s.attr("src",s.attr("pre")),e._setTranslate(i[0],100*r[0]+"%")._setTranslate(i[1],100*r[1]+"%")._setTranslate(i[2],100*r[2]+"%"),t.os.ios?e._setTranslate(n,100*-a+"%"):e._setTranslate(n,-a*e.data("_containerWidth")+"px"),e
},_getDataPos:function(t){var a,e=this;return e.data("loop")?(a=(t+2)%3,2==a?[2,0]:[(a+3)%3,(a+4)%3]):0==t?[-1,-1]:1==t?[-1,0]:(a=(t-1)%3,0==a?[2,0]:[a-1,a])},_setData:function(t,a){var e=this,i=e._getDataPos(t);-1!==i[a]&&e._setItemData(i[a],0==a?t-2:t+2)},_setAllData:function(t){var a=this,e=a._getCurSeq(t);return a.data("loop")?a._setItemData(e[0],t-1)._setItemData(e[1],t)._setItemData(e[2],t+1):0==t?a._setItemData(e[0],t)._setItemData(e[1],t+1)._setItemData(e[2],t+2):t==a.data("num")-1?a._setItemData(e[0],t-2)._setItemData(e[1],t-1)._setItemData(e[2],t):a._setItemData(e[0],t-1)._setItemData(e[1],t)._setItemData(e[2],t+1),a
},_setAutoPlay:function(){var t=this,a=t.data("num"),e=t.data("_cur");return t._setContainerWidth(),e>=a-1&&t.data("_dir",-1),0>=e&&t.data("_dir",1),1==t.data("_dir")?t.nex():t.pre()},_setItemData:function(t,a,e){var i=this,n=(i.data("loop"),i.data("num")),r=i.data("forceInitTpl"),s=i.data("initTpl"),o=i.data("flipTpl"),d=i.data("_items");return 0>a&&(a+=n*(parseInt(-a/n)+1)),a>=n&&(a-=n*parseInt(a/n)),e||r||"function"!=typeof this.flipTpl?d[t].innerHTML=s(a):o.call(i,d[t],a),i},addAutoPlay:function(){var a=this;
return null===a.data("_autoplayInterval")&&a.data("_autoplayInterval",t.later(function(){a._setAutoPlay()},a.data("autoPlayTime"),!0)),a},removeAutoPlay:function(){var t=this;return clearInterval(t.data("_autoplayInterval")),t.data("_autoplayInterval",null),t},pre:function(a){var e,i=this,n=i.data("_cur"),r=i.data("num"),s=i.data("loop");return 0>=n&&!s?i:(i._setData(i.data("_index"),0),0>=n&&s&&i.data("_cur",n+r),n=i.data("_cur")-1,i.data("_cur",n),i.trigger("slide",n),i.data("showDot")&&i.data("_dot").selectDot(i.data("_cur")),e=i.data("_index")-1,i.data("_index",e),i._addPanelTransition(a||1),t.later(function(){i._setItemPos(e,-1)
},0),i)},nex:function(a){var e=this,i=e.data("_cur"),n=e.data("num"),r=e.data("loop");return i>=n-1&&!r?e:(e._setData(e.data("_index"),1),i>=n-1&&r&&e.data("_cur",i-n),i=e.data("_cur"),e.data("_cur",i+1),e.trigger("slide",e.data("_cur")),e.data("showDot")&&e.data("_dot").selectDot(e.data("_cur")),e.data("_index",e.data("_index")+1),e._addPanelTransition(a||1),t.later(function(){e._setItemPos(e.data("_index"),1)},0),e)},curr:function(a){var e=this;return e._addPanelTransition(a||1),t.later(function(){e._setItemPos(e.data("_cur"))
},0),e},slideTo:function(a){var e=this,i=e.data("num");return 0>a||a>=i||a==e.data("_cur")?e:(e.data({_cur:a,_index:a}),e._setAllData(a)._removePanelTransition()._setItemPos(a).trigger("slideFn",a),t.later(function(){e._addPanelTransition()},0),e)},destroy:function(){var a=this,e=t(a.data("container")||document.body)[0];clearInterval(a.data("_autoplayInterval")),a.data("_autoplayInterval",null),a.data("showArr")&&(t(a.data("$larr")).off(),t(a.data("$rarr")).off(),e.removeChild(a.data("$larr")),e.removeChild(a.data("$rarr"))),a.data("showDot")&&e.removeChild(a.data("_dot").container),t(a.data("_panel")).off(),t(window).off("onorientationchange"in window?"orientationchange":"resize",a.data("_resize")),a._super()
}})}(Zepto);