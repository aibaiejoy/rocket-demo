!function(t,a){t.ui.create("refresh",{_data:{container:"",instanceId:"",pullUpText:"加载更多",pullReleaseText:"松开立即加载",loadingText:"加载中...",clickText:"点击加载更多",type:"click",direction:"up",isShow:!0,onReady:null},_create:function(){var t=this;t._createButtonUI(),t.trigger("create")},_init:function(){var a=this,e=a.data("type"),i=a.widget();-1!=t.inArray(a.data("type"),["click","pullup"])&&(a.data({range:150,_isOk:!0,refreshing:!1,list:i.parent().parent(),maxHeight:i.parent().parent().height()||200,maxTop:parseInt(i.parent().parent().get(0).getBoundingClientRect().top)}),"click"==e?a._clickAction():a._pullUpAction(),a.data("isShow")||i.hide(),a.trigger("init"))
},_createButtonUI:function(){var a=this,e=a.widget(),i=[],d=a.data("direction"),n=t(a.data("container")||document.body)[0];-1==t.inArray(a.data("direction"),["up","down"])&&(d="up"),e||(e=a.widget(t("<div></div>")).appendTo(n)),i.push('<span class="ui-refresh-pullup-icon"></span>'),i.push('<span class="ui-refresh-pullup-label">'+a.data("pullup"==a.data("type")?"pullUpText":"clickText")+"</span>"),e.html(i.join("")),e.parent().length?n!==document.body&&("up"==d?e.appendTo(n):e.prependTo(n)):"up"==d?e.appendTo(n):e.prependTo(n),a.data({pullUpLabel:e.find(".ui-refresh-pullup-label"),pullUpIcon:e.find(".ui-refresh-pullup-icon"),dir:d}),a.data("pullUpIcon").hide(),e.addClass(a.data("instanceId")||"ui-refresh")
},_clickAction:function(){var a=this,e=a.widget(),i=t.bind(a._eventHandler,a);e.on("click",i)},_pullUpAction:function(){var a=this,e=a.data("list"),i=t.bind(a._eventHandler,a);e.on("touchstart touchmove touchend",i),a.widget().on("click",i)},_tapHandler:function(){var t=this;if(t.data("_isOk")){var a=t.widget(),e=t.data("pullUpLabel"),i=t.data("pullUpIcon"),d=t.data("type");a.addClass("ui-refresh-loading"),i.show(),e.html(t.data("loadingText")),t.data("onReady").call(this,function(){a.removeClass("ui-refresh-loading"),i.hide(),e.html(t.data("click"==d?"clickText":"pullUpText"))
}),t.data("_isOk",!1)}},_touchStartHandler:function(t){if(t.targetTouches[0]){var a=this,e=a.data("list"),i=a.data("dir"),d=a.data("maxTop"),n=a.data("range"),o=t.targetTouches[0].pageY;("up"==i&&o>e.height()+d-n||"down"==i&&o<d+a.widget().height()+n)&&a.data("startY",o)}},_touchMoveHandler:function(t){var a=this,e=t.targetTouches[0].pageY,i=a.data("startY"),d=a.data("dir"),n=e-i;if(!(!t.targetTouches[0]||!a.data("_isOk")||!i||"up"==d&&n>0||"down"==d&&0>n)){{var o=a.data("pullUpLabel");a.data("range"),a.data("maxTop")
}Math.abs(n)<a.data("maxHeight")&&!a.data("refreshing")&&(o.html(a.data("pullReleaseText")),a.data("refreshing",!0)),a.data("allMoveY",n)}},_touchEndHandler:function(){var t=this,a=t.widget(),e=t.data("pullUpIcon"),i=t.data("pullUpLabel");t.data("refreshing")&&(a.addClass("ui-refresh-loading"),e.show(),i.html(t.data("loadingText")),t.data("onReady").call(this,function(){e.hide(),a.removeClass("ui-refresh-loading"),i.html(t.data("pullUpText"))}),t.data({refreshing:!1,_isOk:!1})),t.data("startY",0)
},setStatus:function(t){var a=this;a.data("_isOk",t?!0:!1)},hide:function(t){var a=this,e=a.widget(),i=t?!0:!1;a.setStatus(i),a.data("isShow")&&(a.data("isShow",!1),e.hide())},show:function(t){var e=this,i=e.widget(),d=t||t==a?!0:!1;e.setStatus(d),e.data("isShow")||(e.data("isShow",!0),i.show())},setLoadEndText:function(t,a){var e=this,i=e.data("pullUpLabel"),d=e.data("pullUpIcon"),n=e.data("click"==e.data("type")?"clickText":"pullUpText"),o=t?t:n,l=a?!0:!1;i.html(o),d&&d.hide(),e.setStatus(l)},_eventHandler:function(a){var e=this;
switch(a.type){case"click":e._tapHandler(a);break;case"touchstart":e._touchStartHandler(a);break;case"touchmove":e._touchMoveHandler(a),3==a.target.nodeType&&t.os.ios&&e._touchEndHandler(a),t.os.android&&e.data("touchMoveTimer",setTimeout(function(){e._touchEndHandler()},1e3));break;case"touchend":e.data("touchEndTimer",setTimeout(function(){e._touchEndHandler(a)},0))}},destroy:function(){var t=this,a=t.data("touchMoveTimer"),e=t.data("touchEndTimer");t.widget().off("click"),t.data("list").off("touchstart touchmove touchend"),a&&clearTimeout(a),e&&clearTimeout(e),t._super()
}})}(Zepto);